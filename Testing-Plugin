#!/bin/bash

# ═══════════════════════════════════════════════════════════════
#  TESTING PLUGIN - Ejecutable Único
#  Doble clic para iniciar todo automáticamente
# ═══════════════════════════════════════════════════════════════

PLUGIN_DIR="/home/jordan/Escritorio/PROYECTO P3 OPERATIVOS/plugin-testing"
ECOMMERCE_DIR="/home/jordan/Escritorio/PROYECTO P3 OPERATIVOS/tienda-ecommerce"

# Colores
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

clear
echo -e "${BLUE}"
echo "╔══════════════════════════════════════════════════════════╗"
echo "║         ⚡ TESTING PLUGIN - v1.0                         ║"
echo "╚══════════════════════════════════════════════════════════╝"
echo -e "${NC}"

# Limpiar procesos anteriores
echo -e "${YELLOW}→ Limpiando procesos anteriores...${NC}"
pkill -f "node.*server.js" 2>/dev/null
pkill -f "node.*launcher.js" 2>/dev/null
sleep 1

# Iniciar E-commerce
echo -e "${YELLOW}→ Iniciando servidor E-commerce...${NC}"
cd "$ECOMMERCE_DIR" && node src/backend/server.js &
sleep 2
echo -e "${GREEN}✓ E-commerce iniciado (puerto 3001)${NC}"

# Iniciar Plugin
echo -e "${YELLOW}→ Iniciando Testing Plugin...${NC}"
cd "$PLUGIN_DIR/src/ui" && node launcher.js &
sleep 3
echo -e "${GREEN}✓ Plugin iniciado (puerto 3002)${NC}"

# Abrir navegador
echo -e "${YELLOW}→ Abriendo navegador...${NC}"
sleep 1
xdg-open "http://localhost:3002" 2>/dev/null &

echo ""
echo -e "${GREEN}════════════════════════════════════════════════════════════${NC}"
echo -e "${GREEN}  ✓ TODO LISTO - http://localhost:3002${NC}"
echo -e "${GREEN}════════════════════════════════════════════════════════════${NC}"
echo ""
echo -e "  ${YELLOW}Presiona Ctrl+C para detener${NC}"
echo ""

# Manejar cierre
trap 'echo ""; echo "→ Deteniendo..."; pkill -f "node.*server.js"; pkill -f "node.*launcher.js"; echo "✓ Listo"; exit 0' SIGINT SIGTERM

# Mantener corriendo
while true; do sleep 1; done
